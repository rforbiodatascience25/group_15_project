---
title: "04_describe"
format:
  html:
    embed-resources: true
editor: visual
execute: 
  echo: true
  message: false
  warning: false
---

## Load data

```{r load library and data}
library(tidyverse)
kidney_merged_GFR <- read_rds("../data/03_data_augment.rds")
```

## Inspecting NA values

The percentage of NAs in each column is summarized here:

```{r calculate_NAs}

nas <- kidney_merged_GFR |> 
     summarise(across(everything(), ~mean(is.na(.)) * 100))

nas |> 
  select(-red_blood_cells) |> 
  unlist() |> 
  mean() 
```

The category with the most missing values is the classification of red blood cells, with 38% missing values. Apart from this category, the average of NAs is around 8%.

## Table 1

We can create a table1 to give us a broad overview about the data. In doing this, we see that there are 250 individuals with chronic kidney disease, and 150 without. Among these, the mean age is 54.5 and 46.5 respectively.

```{r generate_table1}
library("table1")

table1(
  ~ age +
    blood_pressure +
    specific_gravity +
    albumin +
    sugar +
    serum_creatinine +
    blood_urea +
    GFR_average +
    red_blood_cells +
    pus_cells +
    pus_cell_clumps +
    bacteria +
    hemoglobin +
    packed_cell_volume +
    diabetes_mellitus +
    hypertension +
    coronary_artery_disease +
    appetite +
    anemia +
    pedal_edema
    |
    classification,
  data = kidney_merged_GFR
)

```

## Age distribution

Individuals in the dataset include people from 2 to 90 years old. Table1 shows the median, but we can also plot the age distribution for a better overview. The most prevalent groups are people aged from 41 to 70 years old, the majority of which has been diagnosed with chronic kidney disease. The youngest and the oldest age groups are only represented by diagnosed individuals

```{r count_people_in_age_group}
kidney_merged_GFR |> 
  group_by(age_group) |> 
  summarise(count = n()) 

kidney_filter <- kidney_merged_GFR |>  
  drop_na(age_group) 

ggplot(kidney_filter, aes(age_group, fill = classification)) +
  geom_bar(
    position = position_dodge(preserve = "single")) +
  theme_minimal() +
  labs(title="Age distribution",
  x = ("Age Group"),
  y = ("Count"),
  fill = "Classification") 

```

## CDK stage distribution

CDK stage is missing from the table 1, but it would be interesting to see.

```{r CDK_stage_distribution}
stage_labs <- c("Normal", 
                "Mild", 
                "Mild to moderate", 
                "Moderate to severe",
                "Severe", 
                "Failure")

kidney_merged_GFR |>
  subset(!is.na(cdk_stage)) |> 
  ggplot(
    aes(cdk_stage, 
        fill = classification)
  ) +
  geom_bar(
    position = position_dodge(preserve = "single")
    ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45,
                               hjust = 1)
  ) + 
  labs(
    title = "Chronic Kidney Disease (CKD) stage distribution.",
    x = NULL
  ) +
  scale_x_discrete(labels = stage_labs)

```

We see that most of those without CDK fall within normal to mild, which is to be expected. Among individuals with CDK, most have advanced stages of moderate or more, with over 60 falling within the kidney failure category.
